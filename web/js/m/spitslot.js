//计算utf-8字符串的长度var comment_url = siteUrl + '/spitslot/ajax/submit_comment';var isCli = false;var str_length = function(str) {    var len = 0;    var length = str.length;    for (var i=0; i<length; i++) {        if (str.charCodeAt(i)>127 || str.charCodeAt(i)==94) {              len += 3;          } else {             len ++;         }    }    return len;}$(function() {  	$("#comment_img_form").on('change',function(){	    	    var length=$('.up-img-show .up-img-list').children().length;	    $('#length').val(length);	    if(length > 3){	        alert('上传图片数量不能超过3张');	        return false; 	    }	    $("#comment_img_form").submit();	});    /**     * 吐槽按钮     */    $('.btn').on('click',function() {            var params      ={};            var imgs        = '';            var content     = $.trim($("#txt-wrap8").val());            var tel         = $("#tel").val();            var starNum     = 0;            var tag_ids     = '';                        //获取星星个数            starNum = $('.parent-star .curr').size();            params.star_num = starNum;                        //获取选中的标签id            $('.tucao-tags .curr input[type=hidden]').each(function (i, x) {              tag_ids+=$.trim($(x).val(), ' ')+',';            });            if (tag_ids) {              tag_ids = tag_ids.substring(0, tag_ids.length-1);            }            if (!tag_ids) {              alert('请选择标签');              return false;            }            params.tags = tag_ids;                        if(content == '') {                alert("评论内容不能为空");                return false;            }            var str_leng    = str_length(content);            if(str_leng > 500) {                alert('评论内容过多');                return false;            }                        if (str_leng < 15) {                alert('评论内容不能少于5个字符');                return false;            }            params.cont     = content;            // 获取图片            if($('.up-img-show .up-img-list').html() != '') {                $('.up-img-show .up-img-list li').each(function(i) {                    if($(this).attr('data')) {                        imgs += ($(this).attr('data')+',');                    }                });                imgs = imgs.substring(0,imgs.lastIndexOf(','));            }            params.imgs =imgs;              if (isCli) {                return;            }            isCli = true;            $.post(comment_url , params ,function(json) {                if (json.info == 'ok') {                    alert("吐槽成功");                    window.location.href = siteUrl;                } else {                    alert(json.info);                }                isCli = false;            },'json');        });});//评星事件function starEvent(thisObj, starInfo) {  //获取事件元素的索引  var thisIndex = $(thisObj).index();    //先隐藏所有标签并移除curr类  $('.tucao-tags ul li').hide();  $('.tucao-tags ul li').removeClass('curr');    //循环所有星星元素  $('.parent-star .icon-star').each(function (i, x) {    //添加星星类    if (i > thisIndex) {      if ($(x).hasClass('curr')) {        $(x).removeClass('curr');      }    } else {      //获取当期那选中个数-用于取消最后一个      var num = $('.parent-star .curr').size()      //如果是当前事件元素      if (i == thisIndex) {        //如果元素没有curr类则添加        if (!$(x).hasClass('curr')) {          $(x).addClass('curr');        //如果是第一颗星并且有curr类则删除        }        //显示标签        if (num == 1 && !$(x).hasClass('curr')) {//只显示当前等级标签          $('.tucao-tags .tagLevel'+thisIndex).show();            $('.tucao-stars .txt').html(starInfo[thisIndex]);        } else {          $('.tucao-stars .txt').html(starInfo[thisIndex+1]);          //只显示当前等级标签          $('.tucao-tags .tagLevel'+(thisIndex+1)).show();          }             //否则如果没有curr类则添加      } else if (!$(x).hasClass('curr')) {        $(x).addClass('curr');      }    }      });}