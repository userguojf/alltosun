<?php
/**
 * alltosun.com 接收利尔达设备数据控制器 lierda.php
 * ============================================================================
 * 版权所有 (C) 2009-2015 北京互动阳光科技有限公司，并保留所有权利。
 * 网站地址: http://www.alltosun.com
 * ----------------------------------------------------------------------------
 * 许可声明: 这是一个开源程序，未经许可不得将本软件的整体或任何部分用于商业用途及再发布。
 * ============================================================================
 * $Author: 王磊 (wangl@alltosun.com) $
 * $Date: 2017-6-7 上午11:02:28 $
*/

// load func.php
probe_helper::load('func');
//wangjf add 引入设备接口
probe_helper::load('device', 'interface');

class Action
{
    /**
     * 设备提交数据接口
     *
     * @return  String
     */
    public function index()
    {
        device('lierda')->storage();
    }

    /**
     * 测试解析利尔达数据
     *
     * @return string
     */
    public function test()
    {
        // 最终返回的数据
//         $res = array();
//         // $ary = json_decode('[[2,"863075030525198",[["E0:06:E6:84:37:12",-67]],657],[2,"863075030525198",[["78:31:C1:CD:23:8A",-77]],679],[2,"863075030525198",[["34:23:BA:18:6A:F0",-77]],659],[2,"863075030525198",[["F4:5C:89:A1:AA:9F",-65],["64:09:80:28:60:03",-68]],677],[2,"863075030525198",[["A4:5E:60:F3:39:8F",-76],["A0:20:A6:0B:E4:17",-66]],684],[2,"863075030525198",[["88:D5:0C:7B:71:F9",-61]],676],[2,"863075030525198",[["60:C5:A8:60:8A:78",-70],["20:AB:37:5F:05:8F",-75]],686],[2,"863075030525198",[["84:38:35:59:50:F0",-72]],675],[2,"863075030525198",[["4C:32:75:8B:EA:1D",-75],["AC:BC:32:D4:88:A7",-74]],682],[2,"863075030525198",[["00:C1:31:91:E0:32",-72]],668],[2,"863075030525198",[["B4:43:0D:AE:B9:D8",-72]],670],[2,"863075030525198",[["88:6A:B1:EE:FA:79",-79]],673],[2,"863075030525198",[["B4:EF:FA:E3:A8:2B",-60]],674],[2,"863075030525198",[["68:3E:34:E2:1F:8A",-77]],683]]');
//         $res = curl_post('http://201711awifiprobe.alltosun.net/probe/dev/lierda', array('data' => '[{"1":"16120803","2":[["0810763e0770",-77]]},{"1":"16120803","2":[["f01b6c51bc06",-84]]},{"1":"16120803","2":[["286c07b7a650",-65]]},{"1":"16120803","2":[["286c07b7a650",-65]]},{"1":"16120803","2":[["286c07b7a650",-71]]},{"1":"16120803","2":[["286c07b7a650",-63]]},{"1":"16120803","2":[["286c07b7a650",-66]]},{"1":"16120803","2":[["286c07b7a650",-66]]},{"1":"16120803","2":[["0810763e0770",-80]]}]'));
//         var_dump($res);
//         $ary = json_decode('[{"1":"16120803","2":[["0810763e0770",-77]]},{"1":"16120803","2":[["f01b6c51bc06",-84]]},{"1":"16120803","2":[["286c07b7a650",-65]]},{"1":"16120803","2":[["286c07b7a650",-65]]},{"1":"16120803","2":[["286c07b7a650",-71]]},{"1":"16120803","2":[["286c07b7a650",-63]]},{"1":"16120803","2":[["286c07b7a650",-66]]},{"1":"16120803","2":[["286c07b7a650",-66]]},{"1":"16120803","2":[["0810763e0770",-80]]}]', true);
// // an_dump($ary);
//         if ( !$ary ) {
//             return '设备数据错误';
//         }
// p($ary);
//         foreach ($ary as $k => $v) {
//             p($v);
//             $info = isset($v[2][0]) ? $v[2][0] : array();
// //p($info);
//             if ( !$info || !isset($info[0]) || !isset($info[1]) ) {
//                 continue;
//             }
        device('lierda')->storage(array(array(
                'dev'   =>  '16120803',
                'mac'   =>  '20:28:10:00:30:00',
                'rssi'  =>  '0',
                'time'  =>  time()
            )));
            //$this->macs();
        //}
        //an_dump($res);
    }
}
