{include_www file="admin/lib/header_new.html" title="数据管理"}{include_www file="admin/lib/sidebar_new.html"}<style>    .test_btn{        display: inline-block;        height: 35px;        line-height: 35px;        border: 1px solid green;        border-radius: 25px;        padding: 0 25px;        color: green;        vertical-align: middle;        margin: 0 5px 10px 0;	    }    .btn_curr{        color: #fff;        background-color: #31b0d5;        border-color: #269abc;    }    </style><!-- 主内容 start --><div class="main pull-right">    <div class="column">        <div class="position data_title">            <a href="{AnUrl('data/admin/')}"><i class="iconfont iconfont-logo2"></i>数据管理</a>            &gt;            异常数据（{$count}）        </div>                <div class="form-search clearfix">            {*检测空*}            <a href="{AnUrl("data/admin/exception_data?search_filter[empty_data]={if $search_filter.empty_data == 'province'}{$search_filter.empty_data}{else}province{/if}")}">              <span class="test_btn {if $search_filter.empty_data == 'province'}btn_curr{/if}">厅省为空数据</span>            </a>            <a href="{AnUrl("data/admin/exception_data?search_filter[empty_data]={if $search_filter.empty_data == 'city'}{$search_filter.empty_data}{else}city{/if}")}">                <span class="test_btn {if $search_filter.empty_data == 'city'}btn_curr{/if}">厅市为空数据</span>            </a>            <a href="{AnUrl("data/admin/exception_data?search_filter[empty_data]={if $search_filter.empty_data == 'area'}{$search_filter.empty_data}{else}area{/if}")}">                <span class="test_btn {if $search_filter.empty_data == 'area'}btn_curr{/if}">厅区为空数据</span>            </a>                        {*检测本地不存在的区域*}            <a href="{AnUrl("data/admin/exception_data?search_filter[exists_region]={if $search_filter.exists_region == 'province_region'}{$search_filter.exists_region}{else}province_region{/if}")}">                <span class="test_btn {if $search_filter.exists_region == 'province_region'}btn_curr{/if}">检测省不存在（源数据）</span>            </a>            <a href="{AnUrl("data/admin/exception_data?search_filter[exists_region]={if $search_filter.exists_region == 'city_region'}{$search_filter.exists_region}{else}city_region{/if}")}">                <span class="test_btn {if $search_filter.exists_region == 'city_region'}btn_curr{/if}">检测市不存在（源数据）</span>            </a>            <a href="{AnUrl("data/admin/exception_data?search_filter[exists_region]={if $search_filter.exists_region == 'area_region'}{$search_filter.exists_region}{else}area_region{/if}")}">                <span class="test_btn {if $search_filter.exists_region == 'area_region'}btn_curr{/if}">检测区县不存（源数据）</span>            </a>                        {*检测member*}            <a href="javascript:void(0);" data-url="{AnUrl("data/admin/exception_data?search_filter[member]={if $search_filter.member == 1}{$search_filter.member}{else}1{/if}")}">                <span id="check_member" class="test_btn {if $search_filter.member == 1}btn_curr{/if}">member异常数据分析</span>            </a>                        {*检测省市区*}            <a href="javascript:void(0);" data-url="{AnUrl("data/admin/exception_data?search_filter[exception_region]={if $search_filter.exception_region == 1}{$search_filter.exception_region}{else}1{/if}")}">                <span id="exception_region" class="test_btn {if $search_filter.exception_region == 1}btn_curr{/if}">检测营业厅省市区异常</span>            </a>        </div>        <div class="list">            <table class="table table-bordered">                <thead>                  <tr>                      <th width="15%">名称</th>                      <th width="15%">user_number</th>                      <th width="15%">省</th>                      <th width="15%">市</th>                      <th width="15%">区</th>                      <th width="15%">版本号</th>                      <th width="15%">异常类型</th>                  </tr>                </thead>                <tbody>                {foreach $list as $k=>$v}                <tr id="dataList{$v.id}" view_id = "{$v.id}" class="view_id">                    <td>{$v.title}</td>                    <td>{$v.user_number}</td>                    <td>                        {if $search_filter.exists_region == 'province_region'}                            源数据：{$v.province_id}                         {else if $v.province_id}                            {$province_name = business_hall_helper::get_info_name('province' , $v.province_id ,'name')}                        {else}                        {/if}                     </td>                    <td>                                            {if $search_filter.exists_region == 'city_region'}                            源数据：{$v.city_id} <br />                        {else if $v.city_id}                            {business_hall_helper::get_info_name('city' , $v.city_id ,'name')}                        {else}                         {/if}                    </td>                    <td>                        {if $search_filter.exists_region == 'area_region'}                            源数据：{$v.area_id}                        {else if $v.area_id}                            {business_hall_helper::get_info_name('area' , $v.area_id ,'name')}                        {else}                         {/if}                    </td>                    <td>{$v.version}</td>                    <td>                        {if $search_filter.exists_region}                            本地不存在                        {else if $search_filter.empty_data}                            {$search_filter.empty_data}_id不存在                                                    {else if $search_filter.member}                            {data_config::$check_error[$v.errno]}                        {/if}                    </td>                </tr>                {foreachelse}                <tr><td colspan="7">暂无相关信息</td></tr>                {/foreach}                </tbody>            </table>                        {include_www file="admin/lib/pager_new.html"}        </div>    </div>    <!--end:列表--></div><!-- 内容区块 end --></div><script>$(function () {  var cache_lock = new Array();  window['check_member_cache_lock'] = 1; //检测member是否清除缓存  window['exception_region_cache_lock'] = 1; //检测省市区异常时是否清除缓存  var task_lock = 0;                    //任务锁  $('.form-search a').on('click', function () {            //需执行分析任务    if ($(this).attr('href') == 'javascript:void(0);') {      var type = $(this).find('span').attr('id');            //验证是否有任务再执行      if (task_lock) {        alert('有检测任务在执行，请稍等');        return false;      }      $('.form-search a span').removeClass('btn_curr');      $(this).find('span').addClass('btn_curr');      $(this).find('span').html('分析中...');      task_lock = 1;    //任务上锁      check_data(type); return ;    }     $('.form-search a span').removeClass('btn_curr');    $(this).find('span').addClass('btn_curr');    $(this).find('span').html('分析中...');      });});//检测数据执行函数function check_data(type){  //拼接地址  var url = "{AnUrl('data/admin/ajax/check_data')}";  $.post(url, { cache_lock: window[type+'_cache_lock'], type: type }, function (data){    if (window[type+'_cache_lock']) {      window[type+'_cache_lock'] = 0;    }        if (data.info == 'ok') {      //进度      $('#'+type).html('分析中...'+data.ratio+'%');      //回调      check_data(type);    } else if (data.info == 'end') {            //刷新      var url = $('#'+type).closest('a').data('url');      window.location.href=url;    }  }, 'json');}</script><!-- 主内容 end -->{include_www file="admin/lib/footer_new.html"}