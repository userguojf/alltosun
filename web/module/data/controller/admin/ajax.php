<?php/**  * alltosun.com 数据ajax操作文件 ajax.php  * ============================================================================  * 版权所有 (C) 2009-2013 北京互动阳光科技有限公司，并保留所有权利。  * 网站地址: http://www.alltosun.com  * ----------------------------------------------------------------------------  * 许可声明：这是一个开源程序，未经许可不得将本软件的整体或任何部分用于商业用途及再发布。  * ============================================================================  * $Author: 王敬飞 (wangjf@alltosun.com) $  * $Date: 2017年2月17日 下午6:51:11 $  * $Id$  */class Action{    /**     * 刷新页码     */    public function renovate_cache_page()    {        global $mc_wr;        $data_update        = $mc_wr->get('source_data');        $business_update    = $mc_wr->get('business_data');        $result = array(                'info' => 'fail'        );        if ($data_update && isset($data_update['page'])) {            $result['info']         = 'ok';            $result['data_update']  = $data_update['page'];        }        if ($business_update && isset($business_update['page'])) {            $result['info']         = 'ok';            $result['business_update'] = $business_update['page'];        }        return $result;    }    /**     * 检测member数据     */    public function check_data()    {        //是否清除缓存        $cache_lock = tools_helper::post('cache_lock', 0);        //区分检测        $type       = tools_helper::post('type', '');        if (!in_array($type, array('check_member', 'exception_region'))) {            return array('info' => 'fail', 'message' => '不存在的检测类型');        }        //删除缓存        if ($cache_lock) {            global $mc_wr;            $mc_wr->delete('data_'.$type);        }        $result = data_helper::$type();        if ($result['info'] == 'ok') {            $count_var_name = $type.'_count';            $max = data_config::$$count_var_name;            //计算百分比            $result['ratio'] = floor(((($result['page']-1)*$max)/$result['count'])*10000)/100;            if ($result['ratio'] >= 100){                $result['ratio'] = 100;            }        } else if($result['info'] == 'end'){            $result['ratio'] = 100;        }        return $result;    }}