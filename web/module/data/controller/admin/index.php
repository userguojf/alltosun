<?php/**  * alltosun.com 数据管理 index.php  * ============================================================================  * 版权所有 (C) 2009-2013 北京互动阳光科技有限公司，并保留所有权利。  * 网站地址: http://www.alltosun.com  * ----------------------------------------------------------------------------  * 许可声明：这是一个开源程序，未经许可不得将本软件的整体或任何部分用于商业用途及再发布。  * ============================================================================  * $Author: 王敬飞 (wangjf@alltosun.com) $  * $Date: 2017年2月17日 下午2:19:58 $  * $Id$  */class Action{    private $per_page = 10;    private $member_id  = 0;    private $member_res_name = '';    private $member_res_id   = 0;    private $ranks           = 0;    public function __construct()    {        $this->member_id   = member_helper::get_member_id();        $member_info = member_helper::get_member_info($this->member_id);        if ($member_info) {            $this->member_res_name = $member_info['res_name'];            $this->member_res_id   = $member_info['res_id'];            $this->ranks           = $member_info['ranks'];        }        //Response::assign('curr_member_ranks', $this->ranks);        if($this->member_res_name != 'group' ) {            return '您无权操作本模块';exit;        }    }    /**     * 主页     */    public function __call($action="", $params=array())    {        $page_no = tools_helper::get('page_no', 1);        $list    = array();        $filter = array(                1=>1        );        //查询更新记录        $count = _model('data_update_record')->getTotal($filter);        if ($count) {            $pager = new Pager($this->per_page);            //查询更新记录            $list = _model('data_update_record')->getList($filter, ' ORDER BY `id` DESC '.$pager->getLimit($page_no));            if ($pager->generate($count, $page_no)) {                Response::assign('pager', $pager);            }        }        global $mc_wr;        $data_update        = $mc_wr->get('source_data');        $business_update    = $mc_wr->get('business_data');        Response::assign('data_update', $data_update);        Response::assign('business_update', $business_update);        Response::assign('list', $list);        Response::display('admin/index.html');    }    /**     * 错误详情     */    public function error_info()    {        $record_id          = tools_helper::get('record_id', 0);        $page_no            = tools_helper::get('page_no', 1);        $record_info        = _uri('data_update_record', $record_id);        $list               = array();        $count              = 0;        $filter = array('record_id' => $record_id);        if ($record_info){            $count = _model('data_error_log')->getTotal($filter);            if ($count) {                $pager = new Pager($this->per_page);                //查询更新记录                $list = _model('data_error_log')->getList($filter, ' ORDER BY `id` DESC '.$pager->getLimit($page_no));                if ($pager->generate($count, $page_no)) {                    Response::assign('pager', $pager);                }            }        }        Response::assign('record_info', $record_info);        Response::assign('count', $count);        Response::assign('list', $list);        Response::display('admin/error_info.html');    }}